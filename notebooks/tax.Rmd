---
title: "Taxonomy"
output: html_document
date: "2024-10-23"
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = normalizePath("."))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidygraph)
library(ggraph)
```


# Retreive data from docker container
```{bash}
id=$(docker create unigebsp/species_profiler)
docker cp $id:/app/db/tax.rds ./
docker cp $id:/app/db/db.tsv ./
docker rm -v $id
```




# Taxonomy
```{r}
TAX <- readRDS("tax.rds")

# Check graph topology
with_graph(TAX,graph_is_dag())
with_graph(TAX,graph_is_tree())

TAX |>
	ggraph("partition",circular=TRUE) +
	geom_node_arc_bar(aes(fill = rank), size = 0.25) +
	coord_equal()

TAX |>
	ggraph("tree",circular=TRUE) +
	geom_edge_link() +
	geom_node_point(aes(color=rank)) +
	coord_equal() +
	geom_node_label(aes(label=tax_name,fill = rank), size = 2)
```




# DB
```{r}
db <- read_tsv("db.tsv") 
g <- bind_rows(
	distinct(tibble(from=db$genus_id,to=db$species_id)),
	distinct(tibble(from=db$family_id,to=db$genus_id)),
	distinct(tibble(from=db$order_id,to=db$family_id)),
	distinct(tibble(from=db$superkingdom_id,to=db$order_id))
) |>
	filter(!is.na(from),!is.na(to)) |>
	as_tbl_graph()
```


```{r}
ggraph(g,"nicely") + 
	geom_node_point(size=3) + 
	geom_edge_link() + 
	coord_equal()

with_graph(g,graph_is_dag())
with_graph(g,graph_is_tree())

ggraph(g,"nicely") + 
	geom_node_point(size=3) + 
	geom_edge_link() + 
	coord_equal()

g |>
	ggraph("partition",circular=TRUE) + 
		geom_node_arc_bar(size = 0.25) +
		coord_equal()
```






